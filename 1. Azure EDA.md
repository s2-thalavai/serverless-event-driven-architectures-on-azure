## Azure Components:

| Layer                    | Azure Service                               | Purpose                                               |
| ------------------------ | ------------------------------------------- | ----------------------------------------------------- |
| **Event Backbone**       | **Event Grid / Service Bus / Event Hub**    | Routes domain events between microservices            |
| **Compute (Serverless)** | **Azure Functions / Logic Apps**            | Reacts to incoming events (stateless, auto-scale)     |
| **Storage**              | **Azure SQL / Cosmos DB / Blob Storage**    | Persists P2P data (vendor, invoice, PO, etc.)         |
| **Orchestration**        | **Durable Functions / Logic Apps**          | Manages long-running workflows (approvals, payments)  |
| **Integration**          | **API Management + Function Apps**          | Provides API gateways for vendors and ERP integration |
| **Observability**        | **Application Insights + Log Analytics**    | Monitors events, latency, failures                    |
| **Security & Identity**  | **Azure AD / Managed Identity / Key Vault** | Secures secrets and inter-service calls               |

## P2P Event Flow Example

Letâ€™s visualize an Invoice Lifecycle using Azureâ€™s serverless ecosystem:

```
Vendor Portal (Front Door + Static Web App)
        â”‚
        â–¼
[API Management] â†’ [Azure Function: SubmitInvoice]
        â”‚
        â–¼
â†’ emits â†’ Event Grid Topic: InvoiceSubmitted
        â”‚
        â”œâ”€â”€> Subscriber: [Function: ValidateInvoice]
        â”‚       â”œâ”€â”€ Checks vendor & PO validity via Cosmos DB
        â”‚       â””â”€â”€ Emits InvoiceValidated / InvoiceRejected
        â”‚
        â”œâ”€â”€> Subscriber: [Function: OCRExtraction]
        â”‚       â””â”€â”€ Reads from Blob (PDF invoice), enriches metadata
        â”‚
        â””â”€â”€> Subscriber: [Durable Function: ApprovalWorkflow]
                â”œâ”€â”€ Waits for manager approval event
                â”œâ”€â”€ Emits InvoiceApproved
                â””â”€â”€ Triggers downstream payment process

Event Grid â†’ [Function: SchedulePayment]
        â””â”€â”€ Writes PaymentRecord â†’ Azure SQL DB
             + Sends PaymentScheduled event â†’ Teams/SNS/Webhook

```

## Event Taxonomy

| Event Name         | Source              | Consumers                 | Payload                                    |
| ------------------ | ------------------- | ------------------------- | ------------------------------------------ |
| `InvoiceSubmitted` | Vendor Portal       | Validation, OCR, Approval | `{ invoiceId, vendorId, blobUri, amount }` |
| `InvoiceValidated` | Validation Function | Approval Flow             | `{ invoiceId, status, errors }`            |
| `InvoiceApproved`  | Approval Flow       | Payment Scheduler         | `{ invoiceId, approver, timestamp }`       |
| `PaymentScheduled` | Payment Service     | Notification / ERP Sync   | `{ invoiceId, paymentDate, amount }`       |

## Integration Patterns

ðŸ”¹ Event Routing

        - Azure Event Grid for lightweight event notifications.
        
        - Service Bus for guaranteed delivery, message ordering, and retries.
        
        - Hybrid Model: Event Grid triggers â†’ Service Bus queue for reliable consumption by Functions.

ðŸ”¹ Data Synchronization

        - Invoice metadata â†’ Cosmos DB
        
        - Attachments (PDFs, receipts) â†’ Blob Storage
        
        - PO & Vendor master â†’ Azure SQL (multi-tenant partitioning by TenantId)

ðŸ”¹ Multi-Tenant Strategy

        - Use TenantId in event metadata to isolate processing.
        
        - Event Grid Domains for tenant-scoped event routing.
        
        - Cosmos DB containers or Elastic Pool (Azure SQL) for data isolation.
